image: hoangnd4rikkei/android-sdk

stages:
- debug
- release

before_script:
- export GRADLE_USER_HOME=$(pwd)/.gradle
- export DEBUG="debug"
- export PROD="release"
- chmod +x ./gradlew

cache:
  key: ${CI_PROJECT_ID}
  paths:
  - .gradle/
build_debug:
  stage: debug
  except:
  - release
  script:
  - ./gradlew assembleFreeDebug
  - cd app/build/outputs/apk/free/$DEBUG
  - cp app-free-$DEBUG.apk $CI_PROJECT_DIR/$CI_BUILD_REF-free-debug.apk
  - cd $CI_PROJECT_DIR
  - ./gradlew assembleProDebug
  - cd app/build/outputs/apk/pro/$DEBUG
  - cp app-pro-$DEBUG.apk $CI_PROJECT_DIR/$CI_BUILD_REF-pro-debug.apk
  - ls -al $CI_PROJECT_DIR
  artifacts:
    paths:
    - ./$CI_BUILD_REF-free-debug.apk
    - ./$CI_BUILD_REF-pro-debug.apk
    expire_in: 5 day
build_release:
  stage: release
  only:
  - release
  script:
  - ./gradlew assembleFreeRelease
  - cd app/build/outputs/apk/free/$PROD
  - cp app-free-$PROD.apk $CI_PROJECT_DIR/$CI_BUILD_REF-free.apk
  - cd $CI_PROJECT_DIR/app/build/outputs/mapping/free/$PROD
  - cp mapping.txt $CI_PROJECT_DIR/$CI_BUILD_REF-free.txt
  - cd $CI_PROJECT_DIR
  - ./gradlew assembleProRelease
  - cd app/build/outputs/apk/pro/$PROD
  - cp app-pro-$PROD.apk $CI_PROJECT_DIR/$CI_BUILD_REF-pro.apk
  - cd $CI_PROJECT_DIR/app/build/outputs/mapping/pro/$PROD
  - cp mapping.txt $CI_PROJECT_DIR/$CI_BUILD_REF-pro.txt
  - ls -al $CI_PROJECT_DIR
  artifacts:
    paths:
    - ./$CI_BUILD_REF-free.apk
    - ./$CI_BUILD_REF-free.txt
    - ./$CI_BUILD_REF-pro.apk
    - ./$CI_BUILD_REF-pro.txt
    expire_in: 5 day